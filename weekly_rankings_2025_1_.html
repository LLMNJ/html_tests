<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Weekly Fantasy Rankings 2025 Week 1</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
  <style>
    body, table { font-family: 'Archivo', sans-serif; }
    .table-responsive { overflow: visible; }
    #example th, #example td { text-align: center; }
    #example thead th { position: sticky; top: 0; background-color: #f8f9fa; z-index: 2; }
    #example .filter-row input, #example .filter-row select { width: 100%; box-sizing: border-box; text-align: center; }
    #example a { color: #0d6efd; text-decoration: none; }
    #example a:hover { text-decoration: underline; }
    .dataTables_filter { display: none; }
    .desktop-label { display: inline; }
    .mobile-label { display: none; }
    @media (max-width: 576px) {
      #example { table-layout: fixed; width: 100%; }
      #example th, #example td { font-size: 12px; padding: 2px; }
      #example th:nth-child(1), #example td:nth-child(1) { width: 8%; max-width: 32px; white-space: nowrap; text-align: left; }
      #example th:nth-child(2), #example td:nth-child(2) { width: 10%; max-width: 36px; white-space: nowrap; text-align: left; }
      #example th:nth-child(3), #example td:nth-child(3) { width: 10%; max-width: 42px; white-space: nowrap; }
      #example th:nth-child(4), #example td:nth-child(4) { width: 24%; max-width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      #example th:nth-child(5), #example td:nth-child(5) { width: 16%; max-width: 80px; white-space: nowrap; }
      #example th:nth-child(6), #example td:nth-child(6) { width: 18%; max-width: 90px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      #example th:nth-child(7), #example td:nth-child(7) { width: 18%; max-width: 90px; white-space: nowrap; }
      .desktop-label { display: none; }
      .mobile-label { display: inline; }
    }
  </style>
</head>
<body class="p-4">
  <div class="table-responsive">
    <table id="example" class="table table-striped table-hover">
      <thead class="table-light">
        <tr>
          <th><span class="desktop-label">Overall Rank</span><span class="mobile-label">Rk.</span></th>
          <th><span class="desktop-label">Pos Rank</span><span class="mobile-label">PRk</span></th>
          <th><span class="desktop-label">Position</span><span class="mobile-label">Pos.</span></th>
          <th>Name</th>
          <th>Team</th>
          <th>Opponent</th>
          <th>Start (ET)</th>
          <th>Injury</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr class="filter-row">
          <td></td>
          <td></td>
          <td></td>
          <td><input type="text" class="form-control form-control-sm text-center" placeholder="Filter Name"></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <!-- ROWS INSERTED HERE BY R: tbody_html -->
      </tbody>
    </table>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script>
    // Custom sort: treat blank overall ranks as +Infinity so they always sink to the bottom on asc sort
    $.fn.dataTable.ext.type.order["rank-last-pre"] = function (d) {
      if (d === null || d === undefined) return Number.POSITIVE_INFINITY;
      var text = (d + "").replace(/<[^>]*>/g, "").trim();
      if (text === "") return Number.POSITIVE_INFINITY;
      var n = parseFloat(text);
      return isNaN(n) ? Number.POSITIVE_INFINITY : n;
    };

    $(document).ready(function() {
      var table = $("#example").DataTable({
        dom: "B t",
        autoWidth: false,
        order: [[0, "asc"], [1, "asc"]],
        columnDefs: [
          { targets: 0, type: "rank-last" }
        ],
        buttons: [{ extend: "csvHtml5", text: "Export to CSV", filename: "weekly_fantasy_rankings_2025_week_1" }],
        paging: false, ordering: true, info: false, orderCellsTop: true
      });

      // Text input helper
      function addTextInput(colIndex, placeholder) {
        var input = $('<input type="text" class="form-control form-control-sm text-center" placeholder="'+placeholder+'">');
        input.on("keyup change", function() {
          table.column(colIndex).search(this.value).draw();
        });
        $("#example .filter-row td").eq(colIndex).append(input);
      }

      // Dropdown helper (exact match)
      function addDropdown(colIndex, placeholder) {
        var col = table.column(colIndex);
        var vals = col.data().map(function(d) { return $("<div>").html(d).text(); }).toArray();
        vals = Array.from(new Set(vals.filter(Boolean))).sort();
        var sel = $('<select class="form-select form-select-sm text-center"></select>');
        sel.append($("<option>").val("").text(placeholder));
        $.each(vals, function(_, v) { sel.append($("<option>").val(v).text(v)); });
        sel.on("change", function() {
          var esc = this.value.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
          col.search(this.value ? "^" + esc + "$" : "", true, false).draw();
        });
        $("#example .filter-row td").eq(colIndex).append(sel);
      }

      // Existing filters
      addDropdown(2, "Filter");   // Position
      addDropdown(4, "Filter");   // Team
      $(".filter-row input").first().on("keyup change", function() {
        table.column(3).search(this.value).draw();
      });

      // NEW filters
      addDropdown(5, "Filter");   // Opponent
      addTextInput(6, "Filter");  // Start (ET) â€” free text search
      addDropdown(7, "Filter");   // Injury
      addDropdown(8, "Filter");   // Status
    });
  </script>
</body>
</html>
