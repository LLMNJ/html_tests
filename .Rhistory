browser    = "chrome",
chromever  = "latest",
port       = 4571L,
phantom    = FALSE,
verbose    = TRUE
)
rD <- rsDriver(
browser   = "chrome",
chromever = "latest",   # or a specific ChromeDriver version
port      = 4571L,
verbose   = TRUE,
check     = FALSE       # <- this tells it not to fetch phantomJS (or any) drivers
)
remDr <- rD$client
remDr$open()
# install.packages("RSelenium")
library(RSelenium)
# Skip all driver downloads/updates
rD <- rsDriver(
browser   = "chrome",
chromever = "latest",   # or a specific ChromeDriver version
port      = 4571L,
verbose   = TRUE,
check     = FALSE       # <- this tells it not to fetch phantomJS (or any) drivers
)
# Skip all driver downloads/updates
rD <- rsDriver(
browser   = "chrome",
chromever = "latest",   # or a specific ChromeDriver version
port      = 4445L,
verbose   = TRUE,
check     = FALSE       # <- this tells it not to fetch phantomJS (or any) drivers
)
# Skip all driver downloads/updates
rD <- rsDriver(
browser   = "chrome",
chromever = "latest",   # or a specific ChromeDriver version
port      = 4446L,
verbose   = TRUE,
check     = FALSE       # <- this tells it not to fetch phantomJS (or any) drivers
)
remDr <- rD$client
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port              = 4445L,
browserName       = "chrome"
)
remDr$open()
remDr$navigate("https://www.fantasypros.com/accounts/signin/")
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port              = 4445L,
browserName       = "chrome",
path              = "/"          # <— override the default "/wd/hub"
)
remDr$open()                       # should now return TRUE and set remDr$id
# install.packages(c("RSelenium","rvest","dplyr","purrr","tibble"))
library(RSelenium)
library(rvest)
library(dplyr)
library(purrr)
library(tibble)
# 2.1) Point to the Docker container on port 4444, using the default "/wd/hub" path
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port              = 4444L,
browserName       = "chrome",
path              = "wd/hub"
)
# 2.2) Establish the session
remDr$open()
# 0) Install these once:
# install.packages(c("RSelenium","rvest","dplyr","purrr","tibble"))
library(RSelenium)
library(rvest)
library(dplyr)
library(purrr)
library(tibble)
# ——————————————————————————
# 1) Start RSelenium (skipping phantomJS and auto-downloads)
rD <- rsDriver(
browser   = "chrome",
chromever = "latest",  # let it pick the matching driver
port      = 4444L,
check     = FALSE,     # don’t try to fetch phantomjs
verbose   = FALSE
)
library(httr)
library(jsonlite)
# replace this with your API key
your_pff_api_key <- "ce8d8b22932fa533d37bb6497f4f9b07761d04afa4e3b2d6ecf7db79d1c1cd14"
# pff api url
api_url <- "https://api.profootballfocus.com"
# path to the specific API endpoint
api_endpoint <- "/v1/grades/ncaa/2024/season_grade"
# get a temporary access token (jwt)
token_url <- paste0(api_url, "/auth/login")
authorization_response_object <- POST(url = token_url, add_headers("x-api-key" = your_pff_api_key))
jwt_object <- fromJSON(rawToChar(authorization_response_object$content))
# use that token to make a query, in this case to the video/plays api
data_response_object <- GET(url=api_url, path=api_endpoint, add_headers(.headers = c("Authorization"=paste0("Bearer ", jwt_object$jwt))))
# perform processing as needed for the return values from the given endpoint
# conversion to dataframe may be slow depending on the size of the input data
# 'plays' is specific to the return from the 'plays' API
output_df <- fromJSON(rawToChar(data_response_object$content), flatten=T)
# 'output_df' contains one row per play
output_df <- as.data.frame(output_df)
source("/home/nathan/Dropbox/901_functions/Custom header.R")
setwd("~/html_tests")
library(glue)
# Constants for dynamic values
league_type <- "PPR"
number_of_players <- 192
season <- 2025
week <- 1
table_title <- paste("Rest of Season Rankings Following Week ", week, sep = "")
csv_filename <- gsub("\\s+", "_", tolower(table_title))
last_updated_text <- format(
round(as.POSIXct(Sys.time(), tz = "America/New_York"), units = "mins"),
"%a %m/%d %I:%M %p"
)
url <-
"https://docs.google.com/spreadsheets/d/1KbwN3IDUxRzDx9vCMz2Xe4o3eQj7574wFCbW8VrdeFw/edit#gid=80961760"
players <- read_sheet(url, sheet = "players")
source("/home/nathan/Dropbox/901_functions/Custom header.R")
setwd("~/html_tests")
library(glue)
# Constants for dynamic values
league_type <- "PPR"
number_of_players <- 192
season <- 2025
week <- 1
table_title <- paste("Rest of Season Rankings Following Week ", week, sep = "")
csv_filename <- gsub("\\s+", "_", tolower(table_title))
last_updated_text <- format(
round(as.POSIXct(Sys.time(), tz = "America/New_York"), units = "mins"),
"%a %m/%d %I:%M %p"
)
url <-
"https://docs.google.com/spreadsheets/d/1KbwN3IDUxRzDx9vCMz2Xe4o3eQj7574wFCbW8VrdeFw/edit#gid=80961760"
players <- read_sheet(url, sheet = "players")
teams <- read_sheet(url, sheet = "teams")
players <- left_join(
x = players,
y = teams,
by = c("current_team" = "team_last_name...2")
)
players <- players %>%
mutate(
rank = case_when(
league_type == "PPR" ~ players$ppr_rank,
league_type == "half" ~ players$half_rank,
league_type == "standard" ~ players$standard_rank,
league_type == "superflex" ~ players$superflex_rank,
league_type == "dynasty" ~ players$dynasty_rank,
league_type == "dynasty superflex" ~ players$dynasty_superflex_rank,
league_type == "dynasty rookie" ~ players$dynasty_superflex_rank,
league_type == "dynasty rookie superflex" ~
players$dynasty_superflex_rookie_rank,
TRUE ~ players$ppr_rank
)
)
players$player_profile_url <- players$pff_player_url
players <- select(
players,
rank,
position,
name,
current_team,
player_profile_url,
url
)
players <- filter(players, players$rank <= number_of_players) %>%
arrange(rank)
# Build <tbody> rows from dataframe
rows <- apply(players, 1, function(r) {
glue(
'<tr>\n',
'  <td>{r["rank"]}</td>\n',
'  <td>{r["position"]}</td>\n',
'  <td><a href="{r["player_profile_url"]}">{r["name"]}</a></td>\n',
'  <td><a href="{r["url"]}">{r["current_team"]}</a></td>\n',
'</tr>'
)
})
tbody_html <- paste(rows, collapse = "\n")
# Construct full HTML inline
html_lines <- c(
'<!DOCTYPE html>',
'<html lang="en">',
'<html lang="en">',
'<head>',
'  <meta charset="UTF-8">',
'  <meta name="viewport" content="width=device-width, initial-scale=1">',
sprintf('  <title>%s</title>', table_title),
'  <link href="https://fonts.googleapis.com/css2?family=Archivo&display=swap" rel="stylesheet">',
'  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">',
'  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">',
'  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">',
'  <style>',
"    body, table { font-family: 'Archivo', sans-serif; }",
'    .table-responsive { overflow: visible; }',
'    #example th, #example td { text-align: center; }',
'    #example thead th { position: sticky; background-color:#f8f9fa; z-index:2; }',
'    #example thead tr:nth-child(1) th { top: 0; }',
'    #example thead tr.filter-row th { top: 36px; }', # adjust if your header is taller/shorter
'    #example .filter-row input, #example .filter-row select { width: 100%; box-sizing: border-box; text-align: center; }',
'    #example a { color: #0d6efd; text-decoration: none; }',
'    #example a:hover { text-decoration: underline; }',
'    .dataTables_filter { display: none; }',
'    .desktop-label { display: inline; }',
'    .mobile-label { display: none; }',
'    @media (max-width: 576px) {',
'      #example { table-layout: fixed; width: 100%; }',
'      #example th, #example td { font-size: 12px; padding: 2px; }',
'      #example th:nth-child(1), #example td:nth-child(1) {',
'        width: 8%; max-width: 30px; white-space: nowrap; text-align: left; padding-right: 12px;',
'      }',
'      #example th:nth-child(2), #example td:nth-child(2) {',
'        width: 10%; max-width: 35px; white-space: nowrap; text-align: left; padding-right: 12px;',
'      }',
'      #example th:nth-child(3), #example td:nth-child(3) {',
'        width: 35%; max-width: 100px; word-wrap: break-word; white-space: normal;',
'      }',
'      #example th:nth-child(4), #example td:nth-child(4) {',
'        width: 30%; max-width: 70px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;',
'      }',
'      .desktop-label { display: none; }',
'      .mobile-label { display: inline; }',
'    }',
'  </style>',
'</head>',
'<body class="p-4">',
sprintf(
'  <div id="last-updated-block" class="mb-2"><strong>Last Updated:</strong> %s ET</div>',
last_updated_text
),
'  <div class="table-responsive">',
'    <table id="example" class="table table-striped table-hover">',
'      <thead class="table-light">',
'        <tr>',
'          <th><span class="desktop-label">Rank</span><span class="mobile-label">Rk.</span></th>',
'          <th><span class="desktop-label">Position</span><span class="mobile-label">Pos.</span></th>',
'          <th>Name</th>',
'          <th>Team</th>',
'        </tr>',
'        <tr class="filter-row">',
'          <th></th>',
'          <th></th>',
'          <th><input type="text" class="form-control form-control-sm text-center" placeholder="Filter"></th>',
'          <th></th>',
'        </tr>',
'      </thead>',
'      <tbody>',
tbody_html,
'      </tbody>',
'    </table>',
'  </div>',
'  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>',
'  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>',
'  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>',
'  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>',
'  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>',
'  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>',
'  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>',
'  <script>',
'    $(document).ready(function() {',
'      var table = $("#example").DataTable({',
'        dom: "B t",',
'        autoWidth: false,',
'        columnDefs: [',
'          { targets: 0, width: "8%" },',
'          { targets: 1, width: "10%" },',
'          { targets: 2, width: "35%" },',
'          { targets: 3, width: "30%" }',
'        ],',
sprintf(
'        buttons: [{ extend: "csvHtml5", text: "Export to CSV", filename: "%s" }],',
csv_filename
),
'        paging: false, ordering: true, info: false, orderCellsTop: true',
'      });',
'      // name filter input (column 2)',
'      $(".filter-row input").on("keyup change", function() {',
'        table.column(2).search(this.value).draw();',
'      });',
'      // dropdowns for position and team',
'      function addDropdown(colIndex, placeholder) {',
'        var col = table.column(colIndex);',
'        var vals = col.data().map(function(d) { return $("<div>").html(d).text(); }).toArray();',
'        vals = Array.from(new Set(vals)).sort();',
'        var sel = $("<select class=\\"form-select form-select-sm text-center\\"></select>");',
'        sel.append($("<option>").val("").text(placeholder));',
'        $.each(vals, function(_, v) { sel.append($("<option>").val(v).text(v)); });',
'        sel.on("change", function() {',
'          col.search(this.value ? "^" + this.value + "$" : "", true, false).draw();',
'        });',
'        $("#example thead tr.filter-row th").eq(colIndex).append(sel);',
'      }',
'      addDropdown(1, "Filter");',
'      addDropdown(3, "Filter");',
'    });',
'  </script>',
'</body>',
'</html>'
)
file_name <- paste(
"~/html_tests/rest_of_season_rankings",
season,
week,
".html",
sep = "_"
)
# Write HTML and CSV to disk
writeLines(html_lines, file_name)
gert::git_add(".") # stage everything
gert::git_commit("Update HTML") # commit staged files
gert::git_push(remote = "origin")
source("/home/nathan/Dropbox/901_functions/Custom header.R")
setwd("~/html_tests")
library(glue)
# Constants for dynamic values
league_type <- "dynasty"
number_of_players <- 150
season <- 2025
week <- 2
table_title <- paste("Dynsaty Rankings Week ", week, sep = "")
csv_filename <- gsub("\\s+", "_", tolower(table_title))
last_updated_text <- format(
round(as.POSIXct(Sys.time(), tz = "America/New_York"), units = "mins"),
"%a %m/%d %I:%M %p"
)
url <-
"https://docs.google.com/spreadsheets/d/1KbwN3IDUxRzDx9vCMz2Xe4o3eQj7574wFCbW8VrdeFw/edit#gid=80961760"
players <- read_sheet(url, sheet = "players")
teams <- read_sheet(url, sheet = "teams")
players <- left_join(
x = players,
y = teams,
by = c("current_team" = "team_last_name...2")
)
players <- players %>%
mutate(
rank = case_when(
league_type == "PPR" ~ players$ppr_rank,
league_type == "half" ~ players$half_rank,
league_type == "standard" ~ players$standard_rank,
league_type == "superflex" ~ players$superflex_rank,
league_type == "dynasty" ~ players$dynasty_rank,
league_type == "dynasty superflex" ~ players$dynasty_superflex_rank,
league_type == "dynasty rookie" ~ players$dynasty_superflex_rank,
league_type == "dynasty rookie superflex" ~
players$dynasty_superflex_rookie_rank,
TRUE ~ players$ppr_rank
)
)
players$player_profile_url <- players$pff_player_url
players <- select(
players,
rank,
position,
name,
current_team,
player_profile_url,
url
)
players <- filter(players, players$rank <= number_of_players) %>%
arrange(rank)
# Build <tbody> rows from dataframe
rows <- apply(players, 1, function(r) {
glue(
'<tr>\n',
'  <td>{r["rank"]}</td>\n',
'  <td>{r["position"]}</td>\n',
'  <td><a href="{r["player_profile_url"]}">{r["name"]}</a></td>\n',
'  <td><a href="{r["url"]}">{r["current_team"]}</a></td>\n',
'</tr>'
)
})
tbody_html <- paste(rows, collapse = "\n")
# Construct full HTML inline
html_lines <- c(
'<!DOCTYPE html>',
'<html lang="en">',
'<html lang="en">',
'<head>',
'  <meta charset="UTF-8">',
'  <meta name="viewport" content="width=device-width, initial-scale=1">',
sprintf('  <title>%s</title>', table_title),
'  <link href="https://fonts.googleapis.com/css2?family=Archivo&display=swap" rel="stylesheet">',
'  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">',
'  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">',
'  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">',
'  <style>',
"    body, table { font-family: 'Archivo', sans-serif; }",
'    .table-responsive { overflow: visible; }',
'    #example th, #example td { text-align: center; }',
'    #example thead th { position: sticky; background-color:#f8f9fa; z-index:2; }',
'    #example thead tr:nth-child(1) th { top: 0; }',
'    #example thead tr.filter-row th { top: 36px; }', # adjust if your header is taller/shorter
'    #example .filter-row input, #example .filter-row select { width: 100%; box-sizing: border-box; text-align: center; }',
'    #example a { color: #0d6efd; text-decoration: none; }',
'    #example a:hover { text-decoration: underline; }',
'    .dataTables_filter { display: none; }',
'    .desktop-label { display: inline; }',
'    .mobile-label { display: none; }',
'    @media (max-width: 576px) {',
'      #example { table-layout: fixed; width: 100%; }',
'      #example th, #example td { font-size: 12px; padding: 2px; }',
'      #example th:nth-child(1), #example td:nth-child(1) {',
'        width: 8%; max-width: 30px; white-space: nowrap; text-align: left; padding-right: 12px;',
'      }',
'      #example th:nth-child(2), #example td:nth-child(2) {',
'        width: 10%; max-width: 35px; white-space: nowrap; text-align: left; padding-right: 12px;',
'      }',
'      #example th:nth-child(3), #example td:nth-child(3) {',
'        width: 35%; max-width: 100px; word-wrap: break-word; white-space: normal;',
'      }',
'      #example th:nth-child(4), #example td:nth-child(4) {',
'        width: 30%; max-width: 70px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;',
'      }',
'      .desktop-label { display: none; }',
'      .mobile-label { display: inline; }',
'    }',
'  </style>',
'</head>',
'<body class="p-4">',
sprintf(
'  <div id="last-updated-block" class="mb-2"><strong>Last Updated:</strong> %s ET</div>',
last_updated_text
),
'  <div class="table-responsive">',
'    <table id="example" class="table table-striped table-hover">',
'      <thead class="table-light">',
'        <tr>',
'          <th><span class="desktop-label">Rank</span><span class="mobile-label">Rk.</span></th>',
'          <th><span class="desktop-label">Position</span><span class="mobile-label">Pos.</span></th>',
'          <th>Name</th>',
'          <th>Team</th>',
'        </tr>',
'        <tr class="filter-row">',
'          <th></th>',
'          <th></th>',
'          <th><input type="text" class="form-control form-control-sm text-center" placeholder="Filter"></th>',
'          <th></th>',
'        </tr>',
'      </thead>',
'      <tbody>',
tbody_html,
'      </tbody>',
'    </table>',
'  </div>',
'  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>',
'  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>',
'  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>',
'  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>',
'  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>',
'  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>',
'  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>',
'  <script>',
'    $(document).ready(function() {',
'      var table = $("#example").DataTable({',
'        dom: "B t",',
'        autoWidth: false,',
'        columnDefs: [',
'          { targets: 0, width: "8%" },',
'          { targets: 1, width: "10%" },',
'          { targets: 2, width: "35%" },',
'          { targets: 3, width: "30%" }',
'        ],',
sprintf(
'        buttons: [{ extend: "csvHtml5", text: "Export to CSV", filename: "%s" }],',
csv_filename
),
'        paging: false, ordering: true, info: false, orderCellsTop: true',
'      });',
'      // name filter input (column 2)',
'      $(".filter-row input").on("keyup change", function() {',
'        table.column(2).search(this.value).draw();',
'      });',
'      // dropdowns for position and team',
'      function addDropdown(colIndex, placeholder) {',
'        var col = table.column(colIndex);',
'        var vals = col.data().map(function(d) { return $("<div>").html(d).text(); }).toArray();',
'        vals = Array.from(new Set(vals)).sort();',
'        var sel = $("<select class=\\"form-select form-select-sm text-center\\"></select>");',
'        sel.append($("<option>").val("").text(placeholder));',
'        $.each(vals, function(_, v) { sel.append($("<option>").val(v).text(v)); });',
'        sel.on("change", function() {',
'          col.search(this.value ? "^" + this.value + "$" : "", true, false).draw();',
'        });',
'        $("#example thead tr.filter-row th").eq(colIndex).append(sel);',
'      }',
'      addDropdown(1, "Filter");',
'      addDropdown(3, "Filter");',
'    });',
'  </script>',
'</body>',
'</html>'
)
file_name <- paste(
"~/html_tests/dynasty_rankings",
season,
week,
".html",
sep = "_"
)
# Write HTML and CSV to disk
writeLines(html_lines, file_name)
gert::git_add(".") # stage everything
gert::git_commit("Update HTML") # commit staged files
gert::git_push(remote = "origin")
